{% load humanize %}

{% if polizas %}
<div class="table-responsive">
    <table class="table table-hover mb-0">
        <thead>
            <tr>
                <th># Póliza</th>
                <th>Cliente</th>
                <th>Aseguradora</th>
                <th>Ramo</th>
                <th>Fin Vigencia</th>
                <th>Días Restantes</th>
                <th class="text-end">Prima Anual</th>
                <th class="text-center">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for poliza in polizas %}
            <tr>
                <!-- Columna 1: # Póliza -->
                <td><a href="{{ poliza.get_absolute_url }}">{{ poliza.numero_poliza }}</a></td>
                
                <!-- Columna 2: Cliente -->
                <td><a href="{{ poliza.cliente.get_absolute_url }}">{{ poliza.cliente.nombre_completo }}</a></td>
                
                <!-- Columna 3: Aseguradora -->
                <td>{{ poliza.aseguradora.nombre|default:"N/A" }}</td>
                
                <!-- Columna 4: Ramo -->
                <td>{{ poliza.ramo_tipo_seguro }}</td>
                
                <!-- Columna 5: Fin Vigencia -->
                <td>{{ poliza.fecha_fin_vigencia|date:"d/m/Y" }}</td>
                
                <!-- Columna 6: Días Restantes -->
                <td class="fw-bold 
                    {% if poliza.dias_para_renovar is not None and poliza.dias_para_renovar < 0 %}text-danger
                    {% elif poliza.dias_para_renovar is not None and poliza.dias_para_renovar <= 30 %}text-warning
                    {% else %}text-success{% endif %}">
                    {% if poliza.dias_para_renovar is not None %}
                        {% if poliza.dias_para_renovar < 0 %}
                            Venció hace {{ poliza.dias_para_renovar|slice:"1:" }} d.
                        {% else %}
                            {{ poliza.dias_para_renovar }} día{{ poliza.dias_para_renovar|pluralize }}
                        {% endif %}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                
                <!-- Columna 7: Prima Anual -->
                <td class="text-end">${{ poliza.prima_total_anual|floatformat:2|intcomma }}</td>

                <!-- Columna 8: Acciones -->
                <td class="text-center">
                    <div class="btn-group" role="group">
                        <a href="{{ poliza.get_absolute_url }}" class="btn btn-sm btn-info" title="Ver Detalles"><i class="fas fa-eye"></i></a>
                        <a href="{% url 'polizas:editar_poliza' poliza.pk %}" class="btn btn-sm btn-warning" title="Editar Póliza"><i class="fas fa-edit"></i></a>
                        <a href="{% url 'polizas:renovar_poliza' poliza.pk %}" class="btn btn-sm btn-success" title="Renovar Póliza"><i class="fas fa-sync-alt"></i></a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
    <p class="text-muted p-3 mb-0">No hay pólizas en este rango.</p>
{% endif %}