{% extends "base.html" %}
{% load static %}

{% block title %}{{ titulo_pagina }}{% endblock %}

{% block content %}
<div class="page-header">
    <h2><i class="fas fa-file-signature"></i> {{ titulo_pagina }}</h2>
</div>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Errores generales -->
    {% if form.non_field_errors %}
        <div class="alert alert-danger">{{ form.non_field_errors }}</div>
    {% endif %}
    {% if formset.non_form_errors %}
        <div class="alert alert-danger">{{ formset.non_form_errors }}</div>
    {% endif %}

    <!-- Card 1: Datos de la Póliza -->
    <div class="card mb-4">
        <div class="card-header">Información de la Póliza</div>
        <div class="card-body">
            {{ form.as_p }}
        </div>
    </div>
    
    <!-- Card 4: Asegurados en la Póliza -->
    <div class="card">
        <div class="card-header">Asegurados en la Póliza</div>
        <div class="card-body">
            {{ formset.management_form }}
            
            {% for asegurado_form in formset %}
                <div class="asegurado-form mb-4 p-3 border rounded">
                    {{ asegurado_form.as_p }}
                    {% if asegurado_form.instance.pk %}
                        <p>{{ asegurado_form.DELETE }} <label for="{{ asegurado_form.DELETE.id_for_label }}">Marcar para eliminar</label></p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Botones de Acción Finales -->
    <div class="mt-4">
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
        <a href="{% if object %}{{ object.get_absolute_url }}{% else %}{% url 'polizas:lista_polizas' %}{% endif %}" class="btn btn-secondary">Cancelar</a>
    </div>
</form>
{% endblock %}