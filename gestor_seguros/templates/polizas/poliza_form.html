{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}{{ titulo_pagina|default:"Formulario de Póliza" }} - Gestor de Pólizas{% endblock %}

{% block content %}
<h2><i class="fas fa-file-signature"></i> {{ titulo_pagina|default:"Formulario de Póliza" }}</h2>
<hr>
<form method="post" enctype="multipart/form-data" novalidate> <!-- enctype para subida de archivos -->
    {% csrf_token %}

    <div class="row">
        <div class="col-md-6 mb-3">
            {{ form.cliente.label_tag }} {% if form.cliente.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.cliente class+="form-select" %} <!-- form-select para Bootstrap -->
            {% for error in form.cliente.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.aseguradora.label_tag }} {% if form.aseguradora.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.aseguradora class+="form-select" %}
            {% for error in form.aseguradora.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            {{ form.numero_poliza.label_tag }} {% if form.numero_poliza.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.numero_poliza %}
            {% for error in form.numero_poliza.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.ramo_tipo_seguro.label_tag }} {% if form.ramo_tipo_seguro.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.ramo_tipo_seguro %}
            {% for error in form.ramo_tipo_seguro.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
    </div>

    <div class="mb-3">
        {{ form.descripcion_bien_asegurado.label_tag }} {% if form.descripcion_bien_asegurado.field.required %}<span class="text-danger">*</span>{% endif %}
        {% render_field form.descripcion_bien_asegurado %}
        {% for error in form.descripcion_bien_asegurado.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
    </div>

    <h5 class="mt-4">Vigencia y Pagos</h5>
    <hr class="mt-1 mb-3">
    <div class="row">
        <div class="col-md-4 mb-3">
            {{ form.fecha_emision.label_tag }} {% if form.fecha_emision.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.fecha_emision %}
            {% for error in form.fecha_emision.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
        <div class="col-md-4 mb-3">
            {{ form.fecha_inicio_vigencia.label_tag }} {% if form.fecha_inicio_vigencia.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.fecha_inicio_vigencia %}
            {% for error in form.fecha_inicio_vigencia.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
        <div class="col-md-4 mb-3">
            {{ form.fecha_fin_vigencia.label_tag }} {% if form.fecha_fin_vigencia.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.fecha_fin_vigencia %}
            {% for error in form.fecha_fin_vigencia.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-3">
            {{ form.prima_total_anual.label_tag }} {% if form.prima_total_anual.field.required %}<span class="text-danger">*</span>{% endif %}
            <div class="input-group">
                <span class="input-group-text">$</span>
                {% render_field form.prima_total_anual %}
            </div>
            {% for error in form.prima_total_anual.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
        <div class="col-md-4 mb-3">
            {{ form.frecuencia_pago.label_tag }} {% if form.frecuencia_pago.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.frecuencia_pago class+="form-select" %}
            {% for error in form.frecuencia_pago.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
        <div class="col-md-4 mb-3">
            {{ form.valor_cuota.label_tag }} {% if form.valor_cuota.field.required %}<span class="text-danger">*</span>{% endif %}
            <div class="input-group">
                <span class="input-group-text">$</span>
                {% render_field form.valor_cuota %}
            </div>
            {% for error in form.valor_cuota.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
    </div>

    <h5 class="mt-4">Comisiones</h5>
    <hr class="mt-1 mb-3">
    <div class="row">
    <div class="col-md-4 mb-3">
        {{ form.comision_monto.label_tag }}
        <div class="input-group">
            <span class="input-group-text">$</span> 
            {% render_field form.comision_monto %} 
        </div>
        {% for error in form.comision_monto.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
    </div>
        <div class="col-md-4 mb-3">
            {{ form.fecha_cobro_comision.label_tag }} {% if form.fecha_cobro_comision.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.fecha_cobro_comision %}
            {% for error in form.fecha_cobro_comision.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
        <div class="col-md-4 mb-3 align-self-center">
            <div class="form-check">
                {% render_field form.comision_cobrada class+="form-check-input" %}
                <label class="form-check-label" for="{{ form.comision_cobrada.id_for_label }}">
                    {{ form.comision_cobrada.label }}
                </label>
                {% for error in form.comision_cobrada.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
            </div>
        </div>
    </div>

    <h5 class="mt-4">Otros Detalles</h5>
    <hr class="mt-1 mb-3">
    <div class="row">
        <div class="col-md-6 mb-3">
            {{ form.estado_poliza.label_tag }} {% if form.estado_poliza.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.estado_poliza class+="form-select" %}
            {% for error in form.estado_poliza.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
        <div class="col-md-6 mb-3">
            {{ form.archivo_poliza.label_tag }} {% if form.archivo_poliza.field.required %}<span class="text-danger">*</span>{% endif %}
            {% render_field form.archivo_poliza %}
            {% if form.instance and form.instance.archivo_poliza %}
                <small class="form-text text-muted">Actual: <a href="{{ form.instance.archivo_poliza.url }}">{{ form.instance.archivo_poliza.name }}</a></small>
            {% endif %}
            {% for error in form.archivo_poliza.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
        </div>
    </div>

    <div class="mb-3">
        {{ form.notas_poliza.label_tag }} {% if form.notas_poliza.field.required %}<span class="text-danger">*</span>{% endif %}
        {% render_field form.notas_poliza %}
        {% for error in form.notas_poliza.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
    </div>


    <div class="mt-4">
        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> {{ boton_submit|default:"Guardar" }}</button>
        <a href="{% if object %}{{ object.get_absolute_url }}{% else %}{% url 'polizas:lista_polizas' %}{% endif %}" class="btn btn-secondary"><i class="fas fa-times"></i> Cancelar</a>
    </div>
</form>
{% endblock %}
