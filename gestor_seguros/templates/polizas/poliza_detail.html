{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Póliza {{ poliza.numero_poliza }} - Gestor de Pólizas{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>
        <i class="fas fa-file-invoice-dollar"></i> Detalle de Póliza: {{ poliza.numero_poliza }}
        <span class="badge fs-6 ms-2
            {% if poliza.estado_renovacion == 'Vencida' %}bg-danger
            {% elif poliza.estado_renovacion == 'Próxima a vencer' %}bg-warning text-dark
            {% elif poliza.estado_renovacion == 'Vigente' %}bg-success
            {% else %}bg-secondary
            {% endif %}">
            {{ poliza.estado_renovacion }}
            {% if poliza.dias_para_renovar is not None and poliza.dias_para_renovar >= 0 %}
                ({{ poliza.dias_para_renovar }} días)
            {% elif poliza.dias_para_renovar is not None and poliza.dias_para_renovar < 0 %}
                (Venció hace {{ poliza.dias_para_renovar }} días)
            {% endif %}
        </span>
    </h2>
    <div>
        <a href="{% url 'polizas:editar_poliza' poliza.pk %}" class="btn btn-warning"><i class="fas fa-edit"></i> Editar Póliza</a>
        <a href="{% url 'polizas:lista_polizas' %}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Volver a la Lista</a>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        Información General de la Póliza
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>Número de Póliza:</strong> {{ poliza.numero_poliza }}</p>
                <p><strong>Cliente:</strong> <a href="{{ poliza.cliente.get_absolute_url }}">{{ poliza.cliente.nombre_completo }}</a></p>
                <p><strong>Aseguradora:</strong> {{ poliza.aseguradora.nombre|default:"N/A" }}</p>
                <p><strong>Ramo/Tipo de Seguro:</strong> {{ poliza.ramo_tipo_seguro }}</p>
                <p><strong>Descripción Bien Asegurado:</strong> {{ poliza.descripcion_bien_asegurado|linebreaksbr|default:"N/A" }}</p>
                <p><strong>Estado Actual Póliza:</strong> <span class="badge bg-info">{{ poliza.get_estado_poliza_display }}</span></p>
            </div>
            <div class="col-md-6">
                <p><strong>Fecha Emisión:</strong> {{ poliza.fecha_emision|date:"d/m/Y" }}</p>
                <p><strong>Inicio Vigencia:</strong> {{ poliza.fecha_inicio_vigencia|date:"d/m/Y" }}</p>
                <p><strong>Fin Vigencia:</strong> <strong class="{% if poliza.estado_renovacion == 'Vencida' %}text-danger{% elif poliza.estado_renovacion == 'Próxima a vencer' %}text-warning{% endif %}">{{ poliza.fecha_fin_vigencia|date:"d/m/Y" }}</strong></p>
                {% if poliza.proxima_fecha_renovacion_calculada %}
                <p><strong>Próxima Renovación (Estimada):</strong> {{ poliza.proxima_fecha_renovacion_calculada|date:"d/m/Y" }}</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        Valores y Pagos
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>Prima Total Anual:</strong> ${{ poliza.prima_total_anual|floatformat:2|intcomma }}</p>
                <p><strong>Frecuencia de Pago:</strong> {{ poliza.get_frecuencia_pago_display }}</p>
                <p><strong>Valor Cuota (si aplica):</strong> ${{ poliza.valor_cuota|floatformat:2|intcomma|default:"N/A" }}</p>
            </div>
            <div class="col-md-6">
                <p><strong>Porcentaje Comisión:</strong> {{ poliza.comision_porcentaje|floatformat:2 }}%</p>
                <p><strong>Monto Comisión Calculado:</strong> ${{ poliza.monto_comision_calculado|floatformat:2|intcomma }}</p>
                <p><strong>Comisión Cobrada:</strong>
                    {% if poliza.comision_cobrada %}
                        <span class="text-success"><i class="fas fa-check-circle"></i> Sí</span> ({{ poliza.fecha_cobro_comision|date:"d/m/Y"|default:"Fecha no especificada" }})
                    {% else %}
                        <span class="text-danger"><i class="fas fa-times-circle"></i> No</span>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>

{% if poliza.archivo_poliza %}
<div class="card mb-4">
    <div class="card-header">
        Documentos Adjuntos
    </div>
    <div class="card-body">
        <p><a href="{{ poliza.archivo_poliza.url }}" target="_blank" class="btn btn-outline-primary"><i class="fas fa-file-pdf"></i> Ver Archivo de Póliza</a></p>
    </div>
</div>
{% endif %}

{% if poliza.notas_poliza %}
<div class="card mb-4">
    <div class="card-header">
        Notas Adicionales
    </div>
    <div class="card-body">
        {{ poliza.notas_poliza|linebreaksbr }}
    </div>
</div>
{% endif %}

<hr>
<small class="text-muted">Registrada: {{ poliza.fecha_creacion|date:"d/m/Y H:i" }} | Última actualización: {{ poliza.fecha_actualizacion|date:"d/m/Y H:i" }}</small>
{% endblock %}